<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">

  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/style.css">

  <meta name="theme-color" content="#fafafa">
</head>

<body>
  <div class="carousel">
    <div class="item">
      <div id="model-container">
        <model-viewer src="models/sun.glb" id="sun" camera-controls interaction-prompt
          max-camera-orbit='auto auto 2000m' min-camera-orbit='auto auto 2000m' camera-orbit='auto auto 2000m' loading='eager' >
          <div id="annotation-name">SUN</div>
          <div id="annotation-details">
            <div id="details-title"> SUN FACTS</div>
            <div class="row">
              <div class="column">Distance From Galactic Center:</div>
              <div class="column">26,600 light years</div>
              <div class="column">Diameter:</div>
              <div class="column">865,370 miles</div>
              <div class="column">Chemical composition:</div>
              <div class="column">Hydrogen, helium, oxygen, carbon, neon, nitrogen, magnesium, iron and silicon</div>
              <div class="column">Temperature:</div>
              <div class="column">7,470 F - 11,000 F</div>
            </div>
          </div>
        </model-viewer>
      </div>
    </div>
    <div class="item">
      <div id="model-container">
        <model-viewer src="models/mercury.glb" id="mercury" camera-controls interaction-prompt
          max-camera-orbit='auto auto 2000m' min-camera-orbit='auto auto 2000m' camera-orbit='auto auto 2000m' loading='eager'>
          <div id="annotation-name">MERCURY</div>
          <div id="annotation-details">
            <div id="details-title"> MERCURY FACTS</div>
            <div class="row">
              <div class="column">Average Distance from Sun:</div>
              <div class="column">32.743 million miles</div>
              <div class="column">Average Speed Orbiting Sun:</div>
              <div class="column">29.2 miles per second</div>
              <div class="column">Diameter:</div>
              <div class="column">3,031.9 miles</div>
              <div class="column">Tilt of Axis:</div>
              <div class="column">2 degrees</div>
              <div class="column">Length of Year:</div>
              <div class="column">88 days Earth Days</div>
            </div>
          </div>
        </model-viewer>
      </div>
    </div>
    <div class="item">
      <div id="model-container">
        <model-viewer src="models/venus.glb" id="venus" camera-controls interaction-prompt
          max-camera-orbit='auto auto 2000m' min-camera-orbit='auto auto 2000m' camera-orbit='auto auto 2000m' loading='eager'>
          <div id="annotation-name">VENUS</div>
          <div id="annotation-details">
            <div id="details-title"> VENUS FACTS</div>
            <div class="row">
              <div class="column">Average Distance from Sun:</div>
              <div class="column">67.662 million miles</div>
              <div class="column">Average Speed Orbiting Sun:</div>
              <div class="column">21.75 miles per second</div>
              <div class="column">Diameter:</div>
              <div class="column">7,520.8 miles</div>
              <div class="column">Tilt of Axis:</div>
              <div class="column">3 degrees</div>
              <div class="column">Length of Year:</div>
              <div class="column">225 days Earth Days</div>
            </div>
          </div>

        </model-viewer>
      </div>
    </div>
    <div class="item">
      <div id="model-container">
        <model-viewer src="models/earth.glb" id="earth" auto-rotate camera-controls interaction-prompt
          max-camera-orbit='auto auto 2000m' min-camera-orbit='auto auto 2000m' camera-orbit='auto auto 2000m' loading='eager'>
          <div id="annotation-name">EARTH</div>
          <div id="annotation-details">
            <div id="details-title"> EARTH FACTS</div>
            <div class="row">
              <div class="column">Average Distance from Sun:</div>
              <div class="column">93 million miles</div>
              <div class="column">Average Speed Orbiting Sun:</div>
              <div class="column">18.5 miles per second</div>
              <div class="column">Diameter:</div>
              <div class="column">7,926 miles</div>
              <div class="column">Tilt of Axis:</div>
              <div class="column">23.5 degrees</div>
              <div class="column">Length of Year:</div>
              <div class="column">365.25 Days</div>
            </div>
          </div>
        </model-viewer>
      </div>
    </div>
    <div class="item">
      <div id="model-container">
        <model-viewer src="models/mars.glb" id="mars" camera-controls interaction-prompt
          max-camera-orbit='auto auto 2000m' min-camera-orbit='auto auto 2000m' camera-orbit='auto auto 2000m' loading='eager'>
          <div id="annotation-name">MARS</div>
          <div id="annotation-details">
            <div id="details-title"> MARS FACTS</div>
            <div class="row">
              <div class="column">Average Distance from Sun:</div>
              <div class="column">142 million miles</div>
              <div class="column">Average Speed Orbiting Sun:</div>
              <div class="column">14.5 miles per second</div>
              <div class="column">Diameter:</div>
              <div class="column">4,220 miles</div>
              <div class="column">Tilt of Axis:</div>
              <div class="column">25 degrees</div>
              <div class="column">Length of Year:</div>
              <div class="column">687 Earth Days</div>
            </div>
          </div>
        </model-viewer>
      </div>
    </div>
    <div class="item">
      <div id="model-container">
        <model-viewer src="models/jupiter.glb" id="jupiter" camera-controls interaction-prompt
          max-camera-orbit='auto auto 2000m' min-camera-orbit='auto auto 2000m' camera-orbit='auto auto 2000m' loading='eager'>
          <div id="annotation-name">JUPITER</div>
          <div id="annotation-details">
            <div id="details-title"> JUPITER FACTS</div>
            <div class="row">
              <div class="column">Average Distance from Sun:</div>
              <div class="column">479 million miles</div>
              <div class="column">Average Speed Orbiting Sun:</div>
              <div class="column">8.12 miles per second</div>
              <div class="column">Diameter:</div>
              <div class="column">86,881 miles</div>
              <div class="column">Tilt of Axis:</div>
              <div class="column">3.13 degrees</div>
              <div class="column">Length of Year:</div>
              <div class="column">4,333 Earth Days</div>
            </div>
          </div>
        </model-viewer>
      </div>
    </div>
    <div class="item">
      <div id="model-container">
        <model-viewer src="models/saturn.glb" id="saturn" camera-controls interaction-prompt
          max-camera-orbit='auto auto 3000m' min-camera-orbit='auto auto 3000m' camera-orbit='auto auto 3000m' loading='eager'>
          <div id="annotation-name">SATURN</div>
          <div id="annotation-details">
            <div id="details-title"> SATURN FACTS</div>
            <div class="row">
              <div class="column">Average Distance from Sun:</div>
              <div class="column">928.78 million miles</div>
              <div class="column">Average Speed Orbiting Sun:</div>
              <div class="column">6.01 miles per second</div>
              <div class="column">Diameter:</div>
              <div class="column">72,367 miles</div>
              <div class="column">Tilt of Axis:</div>
              <div class="column">26.73 degrees</div>
              <div class="column">Length of Year:</div>
              <div class="column">10,756 Earth Days</div>
            </div>
          </div>
        </model-viewer>
      </div>
    </div>
    <div class="item">
      <div id="model-container">
        <model-viewer src="models/uranus.glb" id="uranus" camera-controls interaction-prompt
          max-camera-orbit='auto auto 2000m' min-camera-orbit='auto auto 2000m' camera-orbit='auto auto 2000m' loading='eager'>
          <div id="annotation-name">URANUS</div>
          <div id="annotation-details">
            <div id="details-title"> URANUS FACTS</div>
            <div class="row">
              <div class="column">Average Distance from Sun:</div>
              <div class="column">1.8398 billion miles</div>
              <div class="column">Average Speed Orbiting Sun:</div>
              <div class="column">3.37 miles per second</div>
              <div class="column">Diameter:</div>
              <div class="column">30,599 miles</div>
              <div class="column">Tilt of Axis:</div>
              <div class="column">97.77 degrees</div>
              <div class="column">Length of Year:</div>
              <div class="column">30,687 Earth Days</div>
            </div>
          </div>
        </model-viewer>
      </div>
    </div>
    <div class="item">
      <div id="model-container">
        <model-viewer src="models/neptune.glb" id="neptune" camera-controls interaction-prompt
          max-camera-orbit='auto auto 2000m' min-camera-orbit='auto auto 2000m' camera-orbit='auto auto 2000m' loading='eager'>
          <div id="annotation-name">NEPTUNE</div>
          <div id="annotation-details">
            <div id="details-title"> NEPTUNE FACTS</div>
            <div class="row">
              <div class="column">Average Distance from Sun:</div>
              <div class="column">2.7816 billion miles</div>
              <div class="column">Average Speed Orbiting Sun:</div>
              <div class="column">8.12 miles per second</div>
              <div class="column">Diameter:</div>
              <div class="column">31,518 miles</div>
              <div class="column">Tilt of Axis:</div>
              <div class="column">28 degrees</div>
              <div class="column">Length of Year:</div>
              <div class="column">60,190 Earth Days</div>
            </div>
          </div>
        </model-viewer>
      </div>
    </div>
    <div class="item">
      <div id="model-container">
        <model-viewer src="models/pluto.glb" id="pluto" camera-controls interaction-prompt
          max-camera-orbit='auto auto 2000m' min-camera-orbit='auto auto 2000m' camera-orbit='auto auto 2000m' loading='eager'>
          <div id="annotation-name">PLUTO</div>
          <div id="annotation-details">
            <div id="details-title"> PLUTO FACTS</div>
            <div class="row">
              <div class="column">Average Distance from Sun:</div>
              <div class="column">3.7 billion miles</div>
              <div class="column">Average Speed Orbiting Sun:</div>
              <div class="column">2.95 miles per second</div>
              <div class="column">Diameter:</div>
              <div class="column">1,476.8 miles</div>
              <div class="column">Tilt of Axis:</div>
              <div class="column">119.5 degrees</div>
              <div class="column">Length of Year:</div>
              <div class="column">90,560 Earth Days</div>
            </div>
          </div>
        </model-viewer>
      </div>
    </div>
  </div>
  <div id="link-debug"></div>

  <div id="qr-container">
    
    <div id="qr-title">Scan QR to control with your phone</div>
    <div id="placeHolder"> </div>
  </div>
  <div id="footer"><div id="footer-link"><a href="https://touchless.valtech.engineering"> Valtech Touchless Experiences</a></div></div>
  <!--google model viewer-->
  <script type="module"
    src="https://modelviewer.dev/node_modules/@google/model-viewer/dist/model-viewer.min.js"></script>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-database.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-analytics.js"></script>

  <!--QR code generator-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>

  <!--physics-->
  <script src="https://unpkg.com/popmotion/dist/popmotion.global.min.js"></script>
  <!--cookie handler -->
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyDNzSRFhlT_Nch6TTB3UZTpFfvW0m8sa1Q",
      authDomain: "touchless-qr.firebaseapp.com",
      databaseURL: "https://touchless-qr.firebaseio.com",
      projectId: "touchless-qr",
      storageBucket: "touchless-qr.appspot.com",
      messagingSenderId: "1069402189378",
      appId: "1:1069402189378:web:6b5314c8e86a87016607db",
      measurementId: "G-8JB2KE736F"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();

    //create some new data values
    var newData = {
      rotation: {
        x: 0,
        y: 0
      },
      motion: 0,
      orient: 0

    }

    const { easing, tween, styler, calc, listen } = window.popmotion;
    const mix = calc.getValueFromProgress;

    const boundaries = document.querySelector('.carousel');
    const box = document.querySelector('.item');
    const boxes = document.querySelectorAll('.item');
    const getBoundariesWidth = () => boundaries.getBoundingClientRect().width - box.getBoundingClientRect().width;
    const divStylers = [];
    let valX, valY = 0;
    let distance = window.innerWidth;
    let planetIndex = 4; // begin at mars
    let elementId = 'earth';
    let startX = 0;
    [].forEach.call(boxes, function (div) {
      // do whatever
      divStylers.push(styler(div));
    });
    console.log("divStylers: " + divStylers.length);
    function resetMovement() {
      movements = [];
    }
    console.log("screen.width: " + distance);
    let uid = null;
    // checking for and adding cookies to prevent repeated additions to the db
    let previousSession = Cookies.get('touchlessqr-cookie'); // => 'value'

    let pageLoaded = false;

    // this is to prevent firebase triggering functions on page load. there may be a better way to do this
    setTimeout(function () {
      pageLoaded = true;
    }, 2000);

    //check if ipad
    isDeviceiPad();

    if (typeof previousSession === 'undefined') {
      previousSession = null;
    }
    if (previousSession != null) {
      uid = previousSession;
      console.log("cookie found - previous session id: " + previousSession);
    } else {
      // Generate a reference to a new location and add some data using push()
      var newPostRef = firebase.database().ref().push(newData);
      // Get the unique key generated by push()
      uid = newPostRef.key;
      //if no previous session found, create new cookie and add new unique field to db
      Cookies.set('touchlessqr-cookie', uid);
      console.log("New cookie id: " + Cookies.get('touchlessqr-cookie'));


    }

    //select selected planet element
    let modelViewer = document.getElementById(elementId);
    var rotX = firebase.database().ref(uid + '/rotation/x/');
    var rotY = firebase.database().ref(uid + '/rotation/y/');
    var buttonRight = firebase.database().ref(uid + '/navigate/right/');
    var buttonLeft = firebase.database().ref(uid + '/navigate/left/');
    rotX.on('value', function (snapshot) {
      valX = snapshot.val();
      modelViewer.cameraOrbit = -valX.toString() + 'deg ' + valY.toString() + 'deg auto';

    });

    rotY.on('value', function (snapshot) {
      valY = snapshot.val();
      console.log(valY);
      modelViewer.cameraOrbit = -valX.toString() + 'deg ' + valY.toString() + 'deg auto';

    });

    buttonRight.on('value', function (snapshot) {
      if (pageLoaded) {
        queueForward();
      }
    });

    buttonLeft.on('value', function (snapshot) {
      if (pageLoaded) {
        queueBackward();
      }
    });


    // on left keypress slide left
    listen(boundaries, 'keydown').filter(e => e.keyCode == '37').start(() => {
      queueBackward();
    });

    // on right keypress slide right
    listen(boundaries, 'keydown').filter(e => e.keyCode == '39').start(() => {
      queueForward();
    });

    //generate qr based on uid
    let qrSize = 3;
    console.log(window.innerWidth);
    // increase qr size on fullsize screens
    if (window.innerWidth > 2000) {
      qrSize = 5;
      document.getElementById("qr-container").style.width = "11em";
      document.getElementById("qr-container").style.height = "14em";
    }
    var modelViewers = document.getElementsByTagName("model-viewer");

    console.log('num modelViewers: ' + modelViewers.length);

    var typeNumber = 4;
    var errorCorrectionLevel = 'L';
    var qr = qrcode(typeNumber, errorCorrectionLevel);
    qr.addData('https://touchless.valtech.engineering/qr/client.html?' + uid);
    qr.make();
    document.getElementById('placeHolder').innerHTML = qr.createSvgTag(qrSize);

    //queue next planet
    function queueForward() {
      //stop planet auto-rotation animation if planet is moving off screen
      document.getElementById(elementId).__autoRotate = false;
      if (planetIndex < 10) {
      divStylers.forEach(element =>
        tween({
          from: startX,
          to: { x: startX - distance },
          duration: 1000,
          ease: easing.anticipate
        }).
        start(element.set, console.log(distance + " " + element.get('x')))
      );
      startX -= distance;
      planetIndex++;
      getElementName();
      modelViewer = document.getElementById(elementId);
      console.log("queueing planet: " + elementId);
      // start new planet auto-rotation animation
      document.getElementById(elementId).__autoRotate = true;
      }
    }

    //queue prev planet
    function queueBackward() {
      //stop planet auto-rotation animation if planet is moving off screen
      document.getElementById(elementId).__autoRotate = false;
      if (planetIndex>1) {
 
      divStylers.forEach(element =>
        tween({
          from: startX,
          to: { x: startX + distance },
          duration: 1000,
          ease: easing.anticipate
        }).
          start(element.set, console.log(distance + " " + element.get('x')))
      );
      startX += distance;
      planetIndex--;

      getElementName();
      modelViewer = document.getElementById(elementId);
      console.log("queueing planet: " + elementId);
      // start new planet auto-rotation animation
      document.getElementById(elementId).__autoRotate = true;
      }
    }

    // queue planet when device tilts
    function handleOrientation(event) {
      if (event.alpha < 150) {
        queueBackward();
      } else if (event.alpha > 210) {
        queueForward();
      }
    }

    // queue planet when device is shaken
    function handleMotionEvent() {
      queueForward();
    }

    function getElementName() {
      switch (planetIndex) {
        case 1:
          elementId = 'sun';
          break;
        case 2:
          elementId = 'mercury';
          break;
        case 3:
          elementId = 'venus';
          break;
        case 4:
          elementId = 'earth';
          break;
        case 5:
          elementId = 'mars';
          break;
        case 6:
          elementId = 'jupiter';
          break;
        case 7:
          elementId = 'saturn';
          break;
        case 8:
          elementId = 'uranus';
          break;
        case 9:
          elementId = 'neptune';
          break;
        case 10:
          elementId = 'pluto';
          break;
      }
    }

    function isDeviceiPad() {
      const iPad = (navigator.userAgent.match(/(iPad)/) /* iOS pre 13 */ ||
        (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1) /* iPad OS 13 */);
      if (iPad)
        distance = screen.height; // account for rotated ipad screen
      return iPad;
    }
  </script>
  
</body>

</html>